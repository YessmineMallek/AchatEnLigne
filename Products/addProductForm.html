<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../styleHome.css">
    <link rel="stylesheet" href="productStyle.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.3.0/css/all.min.css">
    <link rel="icon" href="../images/logo.png">
    <script src="AllArticles.js"></script>


    <title>Add Product</title>
</head>

<body>
    <!--Heder section starts -->
    <header>
        <img width="130px" src="../images/logo.png" id="logo" onmouseover="hover()" onmouseleave="small()">

        <div class="navBar">

            <a href="../home.html">Home</a>




        </div>
        <div class="navBar2">
            <a class="fa fa-sign-out" style="font-size:24px" onclick="LogOut()"></a>

        </div>
    </header>
    <section class="home">
        <div class="content">
            <div class="topixText"><span id="numberProd"></span> Products</div>

            <!--The form to add a product-->
            <div class="admin-product-form-container">
                <form action="" method="#" name="f1" id="myForm">
                    <h3>Add new product</h3>
                    <label class="label" for="name">Product Name <span class="required">*</span></label>
                    <input type="text" placeholder="Enter product name" name="product_name" class="box"
                        id="product_name" required>
                    <label class="label" for="Price">Product Price <span class="required">*</span></label>
                    <input type="number" placeholder="Enter product price" name="product_price" class="box"
                        id="product_price" required>
                    <label for="Sexe" class="label">Gender <span class="required">*</span></label><br>
                    <input type="radio" name="sexe" value="femme" checked><span class="sexe">Women</span>
                    <input type="radio" name="sexe" value="homme"><span class="sexe">Men</span>
                    <input type="radio" name="sexe" value="enfant"><span class="sexe">Kid</span>
                    <br>
                    <br>

                    <input type="file" id="inputFile" accept="image/*" onchange="showFilePath()" required><br>

                    <input type="button" class="btn" name="add_product" value="Save" onclick="ajouter()">
                    <input type="button" class="btn" name="update_product" value="Update" onclick="modifier()">

                    <input type="reset" class="btn" value="Reset" style="align-items: center;">

                </form>
            </div>
            <!--the container to display product-->

            <div class=" product-display">
                <table class="product-display-table" id="product-display-table" name="tab">
                    <thead>
                        <tr>
                            <th> </th>
                            <th>product image</th>
                            <th>product name</th>
                            <th>product price</th>
                            <th>Gender</th>


                        </tr>
                    </thead>

                </table>
            </div>

        </div>
    </section>
</body>


</html>
<script>
    function LogOut() {
        localStorage.clear();
        window.location.href = "../sign up.html"
    }
    var placeNum = document.getElementById("numberProd");

    var products = articlesAll;
    placeNum.innerHTML = products.length;

    function creationNoeud(value) {
        //recuperer la zone de saisie 
        var tableau = document.getElementById("product-display-table");
        //la ligne a inserer 
        var tr = document.createElement("tr")
        tr.id = value["id"];

        //radio button
        var tdBtn = document.createElement("td");
        var input = document.createElement("input");
        input.type = "radio";
        input.name = "products";
        input.setAttribute("onclick", "showDonner(this)");
        input.value = value["id"];
        tdBtn.appendChild(input);
        tr.appendChild(tdBtn);


        //colonne pour image 
        var tdImg = document.createElement("td")
        //creer un image 
        var img = document.createElement("img");
        img.src = value["img"];
        img.height = "100";
        tdImg.appendChild(img);
        //inserer la colonne dans la ligne 
        tr.appendChild(tdImg);


        //colonne pour nom 
        var tdNom = document.createElement("td");
        var nom = document.createTextNode(value["name"]);
        tdNom.appendChild(nom);
        tr.appendChild(tdNom);

        //colonne pour Prix 
        var tdPrice = document.createElement("td");
        var price = document.createTextNode(value["price"]);
        tdPrice.appendChild(price);
        tr.appendChild(tdPrice)

        //colonne pour gender 
        var tdSexe = document.createElement("td");
        var sexe = value["sexe"] == "femme" ? document.createTextNode("Wonem") : (value["sexe"] == "enfant" ? document.createTextNode("Kid") : document.createTextNode("Men"));
        tdSexe.appendChild(sexe);
        tr.appendChild(tdSexe);
        /*****************td delete Icon***************************/
        var tdIcon = document.createElement("td");
        var iIcon = document.createElement("a");
        iIcon.id = value["id"];
        iIcon.setAttribute("onclick", "supprimer(this.id)");

        iIcon.className = "fa-regular fa-circle-xmark"
        tdIcon.appendChild(iIcon);
        tr.appendChild(tdIcon);


        tableau.appendChild(tr);
    }

    products.forEach(afficher);
    function afficher(value, index, array) {

        creationNoeud(value);

    }
    var obj;

    function showDonner(data) {
        var sel = document.getElementsByName("products");

        for (var i = 0; i < products.length; i++) {

            if (products[i]["id"] == data.value)
                obj = products[i];
        }
        document.getElementById("product_name").value = obj["name"];
        document.getElementById("product_price").value = obj["price"];
        for (var i = 0; i < document.getElementsByName("sexe").length; i++) {
            if (document.getElementsByName("sexe")[i].value == obj["sexe"]) {
                document.getElementsByName("sexe")[i].checked = true;
            }
        }

    }



    function showFilePath() {
        let input = document.getElementById("inputFile");
        let file = input.files[0];

    }

    /*************Ajouter method***************/
    function ajouter() {
        //nom
        var nom = document.getElementById("product_name").value;
        //price
        var price = document.getElementById("product_price").value;
        //sexe
        var sexe;
        for (var i = 0; i < document.getElementsByName("sexe").length; i++) {
            if (document.getElementsByName("sexe")[i].checked) {
                sexe = document.getElementsByName("sexe")[i].value;
            }
        }
        //image
        let input = document.getElementById("inputFile");
        let file = input.files[0];

        //ajout

        if (nom !== "" && price !== "" && input.files.length != 0) {
            if (price > 0) {
                var obj = { "id": "", "img": "images/" + file.name, "name": nom, "price": price, "sexe": sexe }
                obj["id"] = "art" + articlesAll.length + (sexe == "femme" ? "F" : (sexe == "kid" ? "K" : ""))
                products.push(obj);
                articlesAll.push(obj)
                placeNum.innerHTML = products.length;
                document.getElementById("myForm").reset();

                creationNoeud(obj);
            } else {
                alert("Price should be positive");
            }

        } else {
            alert("please fill out all")
        }



    }
    /*****************************Modifier Method*************************/
    function modifier() {
        obj["name"] = document.getElementById("product_name").value;
        //price
        obj["price"] = document.getElementById("product_price").value;
        if (obj["name"] !== "" && obj["price"] !== "") {
            //sexe
            var sexe;
            for (var i = 0; i < document.getElementsByName("sexe").length; i++) {
                if (document.getElementsByName("sexe")[i].checked) {
                    sexe = document.getElementsByName("sexe")[i].value;
                }
            }

            if (document.getElementById("inputFile").files.length != 0) {
                let input = document.getElementById("inputFile");
                let file = input.files[0];

            } else {
                for (var i = 0; i < articlesAll.length; i++)
                    if (articlesAll[i]["id"] == obj["id"]) {
                        obj["img"] = articlesAll[i]["img"];
                        obj["sexe"] = sexe;


                    }
            }

            document.getElementById(obj["id"]).remove();
            creationNoeud(obj);
            document.getElementById("myForm").reset();

        } else {
            alert("please fill out all")
        }

    }
    /*****************Supprimer method*********************/
    function supprimer(id) {
        placeNum.innerHTML = (products.length) - 1;

        let index = products.findIndex(obj => obj.id === id);
        products.splice(index, 1);

        document.getElementById(id).remove();
        document.getElementById("product_name").value = "";
        document.getElementById("product_price").value = 0;


    }
    var img = document.getElementById("logo");
    function hover() {
        img.width = "200";
        img.height = "200"

    }
    function small() {
        img.width = "130";
        img.height = "130"

    }

</script>